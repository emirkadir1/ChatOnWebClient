@model User
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css" integrity="sha256-2XFplPlrFClt0bIdPgpz8H7ojnk10H69xRqd9+uTShA=" crossorigin="anonymous" />
<link href="~/css/chat.css" rel="stylesheet" />
<div class="container-xl px-4 mt-4">
    <!-- Account page navigation-->
    <nav class="nav nav-borders">
        <a class="nav-link active ms-0" href="/Home/EditProfile" target="__blank">Profile</a>
        <a class="nav-link" href="/Home/Security" target="__blank">Security</a>
    </nav>
    <hr class="mt-0 mb-4">
    <div class="row">
        <div class="col-xl-4">
            <!-- Profile picture card-->
            <div class="card mb-4 mb-xl-0">
                <div class="card-header">Profile Picture</div>
                <div class="card-body text-center">
                    <!-- Profile picture image-->
                    <img class="img-account-profile rounded-circle mb-2" src="@Model.ImageUrl" alt="" style=" width:150px;height:150px ">
                    <!-- Profile picture help block-->
                    <div class="small font-italic text-muted mb-4">JPG or PNG no larger than 5 MB</div>
                    <!-- Profile picture upload button-->
                    <button class="btn btn-primary" type="button">Upload new image</button>
                </div>
            </div>
        </div>
        <div class="col-xl-8">
            <!-- Account details card-->
            <div class="card mb-4">
                <div class="card-header">Account Details</div>
                <div class="card-body">
                        <!-- Form Group (username
                          <div class="mb-3">
                        <label class="small mb-1" for="inputUsername">Username (how your name will appear to other users on the site)</label>
                        <input class="form-control" id="userName" type="text" placeholder="Enter your username" value="@Model.UserName">
                    </div>
                        -->
                      
                        <!-- Form Row-->
                        <div class="row gx-3 mb-3">
                            <!-- Form Group (first name)-->
                            <div class="col-md-6">
                                <label class="small mb-1" for="inputFirstName">First name</label>
                                <input class="form-control" id="firstName" type="text" placeholder="Enter your first name" value="@Model.FirstName">
                            </div>
                            <!-- Form Group (last name)-->
                            <div class="col-md-6">
                                <label class="small mb-1" for="inputLastName">Last name</label>
                                <input class="form-control" id="lastName" type="text" placeholder="Enter your last name" value="@Model.LastName">
                            </div>
                        </div>
                        <!-- Form Group (email address)-->
                        <div class="mb-3">
                            <label class="small mb-1" for="inputEmailAddress">Email address</label>
                            <input class="form-control" id="email" type="email" placeholder="Enter your email address" value="@Model.Email">
                        </div>
                        <!-- Form Row-->
                        <div class="row gx-3 mb-3">
                            <!-- Form Group (phone number)-->
                            <div class="col-md-6">
                                <label class="small mb-1" for="inputPhone">Phone number</label>
                                <input class="form-control" id="phoneNumber" type="tel" placeholder="Enter your phone number" value="@Model.PhoneNumber">
                            </div>
                            <!-- Form Group (birthday)-->
                            <div class="col-md-6">
                                <label class="small mb-1" for="inputBirthday">Birthday</label>
                                <input class="form-control" type="text" id="birthDate" placeholder="Enter your birthday" value="@Model.BirthDay">
                            </div>
                        </div>
                        <!-- Save changes button-->
                        <button class="btn btn-primary" type="button" id="SetProfile">Save changes</button>                   
                </div>
            </div>
        </div>
    </div>
</div>
@section scripts {
    <script>
        var userName = '@ViewBag.UserName';
        document.getElementById("SetProfile").addEventListener("click", function (event) {
            var email = document.getElementById("email").value;
            var firstName = document.getElementById("firstName").value;
            var lastName = document.getElementById("lastName").value;;
            var phoneNumber = document.getElementById("phoneNumber").value;
            var dateInput = document.getElementById("birthDate");
            var date = new Date(dateInput.value);
            var birthDate = date.toLocaleDateString();
            sendEditRequest(email, firstName, lastName, birthDate, phoneNumber);

            event.preventDefault();
        });
        //Send EditProfileRequest to Api
        function sendEditRequest(email, firstName, lastName, birthDate, phoneNumber) {
            var apiUrl = 'https://localhost:7212/api/User/setprofile'; // WebApi adresi

            // Kullanıcı adı ve şifre bilgilerini JSON formatına dönüştürün
            var requestData = { userName: userName, email: email, firstName: firstName, lastName: lastName, birthDate: birthDate, phoneNumber: phoneNumber };
            var jsonData = JSON.stringify(requestData);

            // HTTP GET isteği oluşturun ve isteği gönderin
            $.ajax({
                url: apiUrl,
                type: 'POST',
                contentType: 'application/json',
                data: jsonData,
                success: function (responseData) {

                    window.location.href = `/Home/EditProfile`;
                },
                error: function (errorData) {
                    // İşlem hatalı olduğunda yapılacak işlemleri burada tanımlayabilirsiniz.
                    alert('Edit Profile işlemi  oldu. Lütfen kullanıcı adı ve şifrenizi kontrol edin.' + errorData);
                }
            });
        }

    </script>

}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>